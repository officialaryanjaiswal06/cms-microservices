
spring.application.name=api-gateway
server.port=8080

# --- EUREKA ---
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true
eureka.instance.prefer-ip-address=true
eureka.instance.hostname=localhost

# --- ROUTES ---
spring.cloud.gateway.routes[0].id=security-route
spring.cloud.gateway.routes[0].uri=lb://SECURITY-SERVICE
spring.cloud.gateway.routes[0].predicates[0]=Path=/auth/**, /register, /login, /users/**, /admin/**, /roles/**, /modules/** , /internal/**
# --- CORS CONFIGURATION ---
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origins=http://localhost:8081
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET, POST, PUT, DELETE, OPTIONS, PATCH
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=Authorization, Content-Type, X-Requested-With, Accept, Origin
spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=true

# ======================================================
# ? CRITICAL FIX: DEDUPLICATE HEADERS
# This removes the duplicate headers caused by having CORS
# in both Gateway and Security Service.
# ======================================================
spring.cloud.gateway.default-filters[0]=DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials, RETAIN_FIRST

#spring.cloud.gateway.routes[1].id=notification-route
#spring.cloud.gateway.routes[1].uri=lb://NOTIFICATION-SERVICE
## Matches: /otp/validate, /push/manual, /push/history
#spring.cloud.gateway.routes[1].predicates[0]=Path=/otp/**, /push/**

spring.cloud.gateway.routes[1].id=notification-service
# Make sure this matches the Eureka Name (Case Sensitive in some versions)
spring.cloud.gateway.routes[1].uri=lb://NOTIFICATION-SERVICE 
spring.cloud.gateway.routes[1].predicates[0]=Path=/otp/**, /push/**, /notifications/**

spring.cloud.gateway.routes[2].id=post-service
spring.cloud.gateway.routes[2].uri=lb://POST-SERVICE

# OLD: Probably looked like Path=/posts/**, /schemas/**
# NEW (FIXED): Must include /content/**
spring.cloud.gateway.routes[2].predicates[0]=Path=/posts/**, /schemas/**, /content/** , /cms/**

spring.cloud.gateway.routes[3].id=chatbot-service
# Make sure this matches spring.application.name in Chatbot Service
spring.cloud.gateway.routes[3].uri=lb://CHATBOT-SERVICE
spring.cloud.gateway.routes[3].predicates[0]=Path=/ai/**